<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Admin – Kelola Produk</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  body{font-family:Inter,system-ui;max-width:1000px;margin:0 auto;padding:24px;background:#f7faf9;color:#0b1220}
  h1{margin-bottom:16px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  table{width:100%;border-collapse:collapse;background:#fff;border:1px solid #e5e9ec}
  th,td{padding:12px;border-bottom:1px solid #e5e9ec;text-align:left}
  input,select,textarea{width:100%;padding:10px;border:1px solid #e5e9ec}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  button{padding:10px 14px;border:none;background:#10bfa4;color:#053b34;font-weight:700;cursor:pointer}
  .danger{background:#ef4444;color:#fff}
  .muted{background:#e5e9ec;color:#0b1220}
</style>
</head>
<body>
  <h1>Admin – Kelola Produk</h1>

  <form id="form">
    <input type="hidden" id="id">
    <div class="row">
      <div><label>Nama</label><input id="name" required></div>
      <div><label>Kategori</label>
        <select id="category">
          <option value="design">design</option>
          <option value="development">development</option>
          <option value="video">video</option>
        </select>
      </div>
    </div>
    <div class="row">
      <div><label>Harga (IDR)</label><input id="price" type="number" min="0" required></div>
      <div><label>Gambar (URL)</label><input id="image" required></div>
    </div>
    <div><label>Deskripsi</label><textarea id="description" rows="3" required></textarea></div>
    <div style="display:flex;gap:8px;margin-top:8px">
      <button type="submit">Simpan</button>
      <button type="button" class="muted" onclick="resetForm()">Reset</button>
    </div>
  </form>

  <h2 style="margin-top:24px">Daftar Produk</h2>
  <table id="table">
    <thead><tr><th>Nama</th><th>Kategori</th><th>Harga</th><th>Aksi</th></tr></thead>
    <tbody></tbody>
  </table>

<script>
async function fetchProducts(){ const r = await fetch('/api/products',{cache:'no-store'}); return r.json(); }
async function createProduct(p){ const r = await fetch('/api/products',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(p)}); return r.json(); }
async function updateProduct(id,p){ const r = await fetch('/api/products/'+id,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(p)}); return r.json(); }
async function deleteProduct(id){ await fetch('/api/products/'+id,{method:'DELETE'}); }

function rowHTML(p){
  const f = new Intl.NumberFormat('id-ID');
  return `<tr>
    <td>${p.name}</td>
    <td>${p.category}</td>
    <td>Rp ${f.format(p.price)}</td>
    <td>
      <button onclick='edit(${JSON.stringify(p)})'>Edit</button>
      <button class="danger" onclick='removeP("${p.id}")'>Hapus</button>
    </td>
  </tr>`;
}
async function render(){
  const items = await fetchProducts();
  document.querySelector('#table tbody').innerHTML = items.map(rowHTML).join('');
}
function resetForm(){ document.getElementById('form').reset(); document.getElementById('id').value=''; }
function edit(p){ for(const k of ['id','name','category','price','image','description']) document.getElementById(k).value=p[k]; window.scrollTo({top:0,behavior:'smooth'}); }
async function removeP(id){ if(!confirm('Hapus produk?')) return; await deleteProduct(id); await render(); }

document.getElementById('form').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const p = {
    id: document.getElementById('id').value || undefined,
    name: document.getElementById('name').value.trim(),
    category: document.getElementById('category').value,
    price: +document.getElementById('price').value,
    image: document.getElementById('image').value.trim(),
    description: document.getElementById('description').value.trim()
  };
  if(p.id) await updateProduct(p.id, p); else await createProduct(p);
  resetForm(); await render();
});

render();
</script>
</body>
</html>
